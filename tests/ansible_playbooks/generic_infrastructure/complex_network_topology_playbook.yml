---
- name: Threat Model Configuration
  hosts: localhost
  connection: local
  vars:
    threat_model_metadata:
      boundaries:
        - name: "infra_boundary"
          type: "DMZ"
          isTrusted: True
          sub_boundaries:
            - name: "main"
              type: "Internal"
              isTrusted: True
            - name: "fallback"
              type: "Internal"
              isTrusted: True

      actors:
        - name: "Operator"
          isHuman: True
          boundary: "infra_boundary"
        - name: "Admin"
          isHuman: True
          boundary: "infra_boundary"

      servers:
        - name: "RIE"
          stereotype: "Server"
        - name: "Router_RIE_InfraBoundary"
          stereotype: "Router"
        - name: "Switch_Main_Fallback"
          stereotype: "Switch"
          boundary: "infra_boundary"
        - name: "Switch_Main"
          stereotype: "Switch"
          boundary: "main"
        - name: "Frontend_1"
          stereotype: "Server"
          boundary: "main"
        - name: "Frontend_2"
          stereotype: "Server"
          boundary: "main"
        - name: "Frontend_3"
          stereotype: "Server"
          boundary: "main"
        - name: "Frontend_4"
          stereotype: "Server"
          boundary: "main"
        - name: "Frontend_5"
          stereotype: "Server"
          boundary: "main"
        - name: "Server_1"
          stereotype: "Server"
          boundary: "main"
        - name: "Server_2"
          stereotype: "Server"
          boundary: "main"
        - name: "Server_3"
          stereotype: "Server"
          boundary: "main"
        - name: "Server_4"
          stereotype: "Server"
          boundary: "main"
        - name: "Server_5"
          stereotype: "Server"
          boundary: "main"
        - name: "Switch_Fallback"
          stereotype: "Switch"
          boundary: "fallback"
        - name: "Frontend_1_Fallback"
          stereotype: "Server"
          boundary: "fallback"
        - name: "Frontend_2_Fallback"
          stereotype: "Server"
          boundary: "fallback"
        - name: "Frontend_3_Fallback"
          stereotype: "Server"
          boundary: "fallback"
        - name: "Frontend_4_Fallback"
          stereotype: "Server"
          boundary: "fallback"
        - name: "Frontend_5_Fallback"
          stereotype: "Server"
          boundary: "fallback"
        - name: "Server_1_Fallback"
          stereotype: "Server"
          boundary: "fallback"
        - name: "Server_2_Fallback"
          stereotype: "Server"
          boundary: "fallback"
        - name: "Server_3_Fallback"
          stereotype: "Server"
          boundary: "fallback"
        - name: "Server_4_Fallback"
          stereotype: "Server"
          boundary: "fallback"
        - name: "Server_5_Fallback"
          stereotype: "Server"
          boundary: "fallback"

      data:
        - name: "Web Traffic"
          classification: "PUBLIC"
          lifetime: "TRANSIENT"
        - name: "SSH Traffic"
          classification: "RESTRICTED"
          lifetime: "TRANSIENT"
        - name: "Internal Traffic"
          classification: "RESTRICTED"
          lifetime: "TRANSIENT"
        - name: "Any Traffic"
          classification: "PUBLIC"
          lifetime: "TRANSIENT"

      data_flows:
        - name: "Operator to Main_Fallback Switch"
          source: "actor:Operator"
          destination: "server:Switch_Main_Fallback"
          protocol: "HTTPS"
          data: "Web Traffic"
        - name: "Admin to Main_Fallback Switch"
          source: "actor:Admin"
          destination: "server:Switch_Main_Fallback"
          protocol: "SSH"
          data: "SSH Traffic"
        - name: "Switch_Main_Fallback to Switch_Main HTTPS"
          source: "server:Switch_Main_Fallback"
          destination: "server:Switch_Main"
          protocol: "HTTPS"
          data: "Web Traffic"
        - name: "Switch_Main_Fallback to Switch_Main SSH"
          source: "server:Switch_Main_Fallback"
          destination: "server:Switch_Main"
          protocol: "SSH"
          data: "SSH Traffic"
        - name: "Switch_Main to Switch_Main_Fallback HTTPS"
          source: "server:Switch_Main"
          destination: "server:Switch_Main_Fallback"
          protocol: "HTTPS"
          data: "Web Traffic"
        - name: "Switch_Main to Switch_Main_Fallback SSH"
          source: "server:Switch_Main"
          destination: "server:Switch_Main_Fallback"
          protocol: "SSH"
          data: "SSH Traffic"
        - name: "Switch_Main_Fallback to Switch_Fallback HTTPS"
          source: "server:Switch_Main_Fallback"
          destination: "server:Switch_Fallback"
          protocol: "HTTPS"
          data: "Web Traffic"
        - name: "Switch_Main_Fallback to Switch_Fallback SSH"
          source: "server:Switch_Main_Fallback"
          destination: "server:Switch_Fallback"
          protocol: "SSH"
          data: "SSH Traffic"
        - name: "Switch_Fallback to Switch_Main_Fallback HTTPS"
          source: "server:Switch_Fallback"
          destination: "server:Switch_Main_Fallback"
          protocol: "HTTPS"
          data: "Web Traffic"
        - name: "Switch_Fallback to Switch_Main_Fallback SSH"
          source: "server:Switch_Fallback"
          destination: "server:Switch_Main_Fallback"
          protocol: "SSH"
          data: "SSH Traffic"
        - name: "Frontend_1 to Switch_Main"
          source: "server:Frontend_1"
          destination: "server:Switch_Main"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Frontend_2 to Switch_Main"
          source: "server:Frontend_2"
          destination: "server:Switch_Main"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Frontend_3 to Switch_Main"
          source: "server:Frontend_3"
          destination: "server:Switch_Main"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Frontend_4 to Switch_Main"
          source: "server:Frontend_4"
          destination: "server:Switch_Main"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Frontend_5 to Switch_Main"
          source: "server:Frontend_5"
          destination: "server:Switch_Main"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Server_1 to Switch_Main"
          source: "server:Server_1"
          destination: "server:Switch_Main"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Server_2 to Switch_Main"
          source: "server:Server_2"
          destination: "server:Switch_Main"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Server_3 to Switch_Main"
          source: "server:Server_3"
          destination: "server:Switch_Main"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Server_4 to Switch_Main"
          source: "server:Server_4"
          destination: "server:Switch_Main"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Server_5 to Switch_Main"
          source: "server:Server_5"
          destination: "server:Switch_Main"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Main to Frontend_1"
          source: "server:Switch_Main"
          destination: "server:Frontend_1"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Main to Frontend_2"
          source: "server:Switch_Main"
          destination: "server:Frontend_2"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Main to Frontend_3"
          source: "server:Switch_Main"
          destination: "server:Frontend_3"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Main to Frontend_4"
          source: "server:Switch_Main"
          destination: "server:Frontend_4"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Main to Frontend_5"
          source: "server:Switch_Main"
          destination: "server:Frontend_5"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Main to Server_1"
          source: "server:Switch_Main"
          destination: "server:Server_1"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Main to Server_2"
          source: "server:Switch_Main"
          destination: "server:Server_2"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Main to Server_3"
          source: "server:Switch_Main"
          destination: "server:Server_3"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Main to Server_4"
          source: "server:Switch_Main"
          destination: "server:Server_4"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Main to Server_5"
          source: "server:Switch_Main"
          destination: "server:Server_5"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Frontend_1_Fallback to Switch_Fallback"
          source: "server:Frontend_1_Fallback"
          destination: "server:Switch_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Frontend_2_Fallback to Switch_Fallback"
          source: "server:Frontend_2_Fallback"
          destination: "server:Switch_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Frontend_3_Fallback to Switch_Fallback"
          source: "server:Frontend_3_Fallback"
          destination: "server:Switch_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Frontend_4_Fallback to Switch_Fallback"
          source: "server:Frontend_4_Fallback"
          destination: "server:Switch_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Frontend_5_Fallback to Switch_Fallback"
          source: "server:Frontend_5_Fallback"
          destination: "server:Switch_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Server_1_Fallback to Switch_Fallback"
          source: "server:Server_1_Fallback"
          destination: "server:Switch_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Server_2_Fallback to Switch_Fallback"
          source: "server:Server_2_Fallback"
          destination: "server:Switch_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Server_3_Fallback to Switch_Fallback"
          source: "server:Server_3_Fallback"
          destination: "server:Switch_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Server_4_Fallback to Switch_Fallback"
          source: "server:Server_4_Fallback"
          destination: "server:Switch_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Server_5_Fallback to Switch_Fallback"
          source: "server:Server_5_Fallback"
          destination: "server:Switch_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Fallback to Frontend_1_Fallback"
          source: "server:Switch_Fallback"
          destination: "server:Frontend_1_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Fallback to Frontend_2_Fallback"
          source: "server:Switch_Fallback"
          destination: "server:Frontend_2_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Fallback to Frontend_3_Fallback"
          source: "server:Switch_Fallback"
          destination: "server:Frontend_3_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Fallback to Frontend_4_Fallback"
          source: "server:Switch_Fallback"
          destination: "server:Frontend_4_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Fallback to Frontend_5_Fallback"
          source: "server:Switch_Fallback"
          destination: "server:Frontend_5_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Fallback to Server_1_Fallback"
          source: "server:Switch_Fallback"
          destination: "server:Server_1_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Fallback to Server_2_Fallback"
          source: "server:Switch_Fallback"
          destination: "server:Server_2_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Fallback to Server_3_Fallback"
          source: "server:Switch_Fallback"
          destination: "server:Server_3_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Fallback to Server_4_Fallback"
          source: "server:Switch_Fallback"
          destination: "server:Server_4_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "Switch_Fallback to Server_5_Fallback"
          source: "server:Switch_Fallback"
          destination: "server:Server_5_Fallback"
          protocol: "Any"
          data: "Internal Traffic"
        - name: "RIE to Router_RIE_InfraBoundary"
          source: "server:RIE"
          destination: "server:Router_RIE_InfraBoundary"
          protocol: "Any"
          data: "Any Traffic"
          description: "Traffic from RIE to the Router at the InfraBoundary"
        - name: "Router_RIE_InfraBoundary to Infra_Boundary Switch"
          source: "server:Router_RIE_InfraBoundary"
          destination: "server:Switch_Main_Fallback"
          protocol: "Any"
          data: "Any Traffic"
          description: "Traffic from Router to the main switch in InfraBoundary"

- name: Configure Router and Switch
  hosts: Router_RIE_InfraBoundary, Switch_Main
  become: yes
  tasks:
    - name: Ensure basic network connectivity (placeholder)
      ansible.builtin.debug:
        msg: "Configuring network connectivity for {{ inventory_hostname }}"

- name: Configure Frontend Servers
  hosts: Frontend_1, Frontend_2, Frontend_3, Frontend_4, Frontend_5
  become: yes
  tasks:
    - name: Install Nginx for HTTPS
      ansible.builtin.apt:
        name: nginx
        state: present
    - name: Allow HTTPS traffic on port 443
      ansible.builtin.ufw:
        rule: allow
        port: '443'
        proto: tcp

- name: Configure Backend Servers
  hosts: Server_1, Server_2, Server_3, Server_4, Server_5
  become: yes
  tasks:
    - name: Install OpenSSH Server
      ansible.builtin.apt:
        name: openssh-server
        state: present